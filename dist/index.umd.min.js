!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).Mathador={})}(this,(function(t){"use strict";function i(t,i,s,r,e,a){const h=r-t,n=e-i,x=a-s;return Math.sqrt(h*h+n*n+x*x)}function s(t,i,s){return Math.max(i,Math.min(t,s))}class r{constructor(t=0,i=0,s=0,r="XYZ"){this.x=t,this.y=i,this.z=s,this.order=r}static fromEuler(t){return(new r).setFromEuler(t)}static fromRotationMatrix(t,i){return(new r).setFromRotationMatrix(t,i)}static equals(t,i){return t.equals(i)}clone(){return new r(this.x,this.y,this.z,this.order)}set(t,i,s,r="XYZ"){return this.x=t,this.y=i,this.z=s,this.order=r,this}setFromEuler(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.order===t.order}setFromRotationMatrix(t,i){const r=t.toArray();if(16!==r.length)throw new Error("Matrix must contain 16 elements");const[e,a,h,n,x,o,y,_,u,l,c,z,m,w,d,M]=r;switch(i){case"XYZ":this.y=Math.asin(s(u,-1,1)),Math.abs(u)<.999999?(this.x=Math.atan2(-l,c),this.z=Math.atan2(-x,e)):(this.x=Math.atan2(y,o),this.z=0);break;case"XZY":this.z=Math.asin(-s(x,-1,1)),Math.abs(x)<.999999?(this.x=Math.atan2(y,o),this.y=Math.atan2(u,e)):(this.x=Math.atan2(-l,c),this.y=0);break;case"YXZ":this.x=Math.asin(-s(l,-1,1)),Math.abs(l)<.999999?(this.y=Math.atan2(u,c),this.z=Math.atan2(a,o)):(this.y=Math.atan2(-h,e),this.z=0);break;case"YZX":this.z=Math.asin(s(a,-1,1)),Math.abs(a)<.999999?(this.x=Math.atan2(-l,o),this.y=Math.atan2(-h,e)):(this.x=0,this.y=Math.atan2(u,c));break;case"ZXY":this.x=Math.asin(s(y,-1,1)),Math.abs(y)<.999999?(this.y=Math.atan2(-h,c),this.z=Math.atan2(-x,o)):(this.y=0,this.z=Math.atan2(a,e));break;case"ZYX":this.y=Math.asin(-s(h,-1,1)),Math.abs(h)<.999999?(this.x=Math.atan2(y,c),this.z=Math.atan2(a,e)):(this.x=0,this.z=Math.atan2(-x,o))}return this.order=i,this}}class e{constructor(t=0,i=0){this.length=2,this.x=t,this.y=i}static multiplyByScalar(t,i){return new e(t.x*i,t.y*i)}static addScalar(t,i){return new e(t.x+i,t.y+i)}static normalize(t){return(new e).setFromVec2(t).normalize()}static add(t,i){return new e(t.x+i.x,t.y+i.y)}static substract(t,i){return new e(t.x-i.x,t.y-i.y)}static dotProduct(t,i){return t.x*i.x+t.y*i.y}static applyMat3(t,i){return t.clone().applyMat3(i)}static lerp(t,i,s){return t.clone().lerp(i,s)}static rotate(t,i,s){return t.clone().rotate(i,s)}static equals(t,i,s=6){return!!t&&t.equals(i)}static getDistance(t,i){const s=i.x-t.x,r=i.y-t.y;return Math.sqrt(s*s+r*r)}static minMax(...t){return{min:new e(Math.min(...t.map((t=>t.x))),Math.min(...t.map((t=>t.y)))),max:new e(Math.max(...t.map((t=>t.x))),Math.max(...t.map((t=>t.y))))}}clone(){return new e(this.x,this.y)}set(t,i){return this.x=t,this.y=i,this}setFromVec2(t){return this.x=t.x,this.y=t.y,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return e.dotProduct(this,t)}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:i,y:s}=this,[r,e,,a,h,,n,x]=t;return this.x=i*r+s*a+n,this.y=i*e+s*h+x,this}lerp(t,i){return this.x+=i*(t.x-this.x),this.y+=i*(t.y-this.y),this}rotate(t,i){const s=Math.sin(i),r=Math.cos(i),e=this.x-t.x,a=this.y-t.y;return this.x=e*r-a*s+t.x,this.y=e*s+a*r+t.y,this}equals(t,i=6){return!!t&&(+this.x.toFixed(i)==+t.x.toFixed(i)&&+this.y.toFixed(i)==+t.y.toFixed(i))}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class a{constructor(){this.length=9,this._matrix=new Array(this.length),this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1}get x_x(){return this._matrix[0]}get x_y(){return this._matrix[1]}get x_z(){return this._matrix[2]}get y_x(){return this._matrix[3]}get y_y(){return this._matrix[4]}get y_z(){return this._matrix[5]}get z_x(){return this._matrix[6]}get z_y(){return this._matrix[7]}get z_z(){return this._matrix[8]}static fromMat3(t){return(new a).setFromMat3(t)}static fromMat4(t){return(new a).setFromMat4(t)}static from4Vec2(t,i,s,r,h=!1){const n=new a;n.applyTranslation(-t.x,-t.y);const x=e.substract(i,t).getMagnitude(),o=e.substract(r,s).getMagnitude()/x;if(n.applyScaling(o),!h){const e=Math.atan2(i.y-t.y,i.x-t.x)-Math.atan2(r.y-s.y,r.x-s.x);n.applyRotation(e)}return n.applyTranslation(s.x,s.y),n}static multiply(t,i){const[s,r,e,h,n,x,o,y,_]=t._matrix,[u,l,c,z,m,w,d,M,g]=i._matrix,p=new a;return p.set(s*u+r*z+e*d,s*l+r*m+e*M,s*c+r*w+e*g,h*u+n*z+x*d,h*l+n*m+x*M,h*c+n*w+x*g,o*u+y*z+_*d,o*l+y*m+_*M,o*c+y*w+_*g),p}static multiplyScalar(t,i){const s=new a;for(let r=0;r<this.length;r++)s._matrix[r]=t._matrix[r]*i;return s}static transpose(t){const i=new a;return i.set(t.x_x,t.y_x,t.z_x,t.x_y,t.y_y,t.z_y,t.x_z,t.y_z,t.z_z),i}static invert(t){const i=new a;i.set(t.y_y*t.z_z-t.z_y*t.y_z,t.y_x*t.z_z-t.z_x*t.y_z,t.y_x*t.z_y-t.z_x*t.y_y,t.x_y*t.z_z-t.z_y*t.x_z,t.x_x*t.z_z-t.z_x*t.x_z,t.x_x*t.z_y-t.z_x*t.x_y,t.x_y*t.y_z-t.y_y*t.x_z,t.x_x*t.y_z-t.y_x*t.x_z,t.x_x*t.y_y-t.y_x*t.x_y),i.set(i.x_x,-i.x_y,i.x_z,-i.y_x,i.y_y,-i.y_z,i.z_x,-i.z_y,i.z_z);const s=t.x_x*i.x_x+t.x_y*i.x_y+t.x_z*i.x_z,r=new a;if(s){const t=1/s;r.set(t*i.x_x,t*i.y_x,t*i.z_x,t*i.x_y,t*i.y_y,t*i.z_y,t*i.x_z,t*i.y_z,t*i.z_z)}else r.set(0,0,0,0,0,0,0,0,0);return r}static buildScale(t,i){return null!=i||(i=t),(new a).set(t,0,0,0,i,0,0,0,1)}static buildRotation(t){const i=Math.cos(t),s=Math.sin(t);return(new a).set(i,-s,0,s,i,0,0,0,1)}static buildTranslate(t,i){return(new a).set(1,0,0,0,1,0,t,i,1)}static equals(t,i,s=6){return t.equals(i,s)}clone(){return(new a).set(this.x_x,this.x_y,this.x_z,this.y_x,this.y_y,this.y_z,this.z_x,this.z_y,this.z_z)}set(t,i,s,r,e,a,h,n,x){return this._matrix[0]=t,this._matrix[1]=i,this._matrix[2]=s,this._matrix[3]=r,this._matrix[4]=e,this._matrix[5]=a,this._matrix[6]=h,this._matrix[7]=n,this._matrix[8]=x,this}reset(){return this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1,this}setFromMat3(t){for(let i=0;i<this.length;i++)this._matrix[i]=t._matrix[i];return this}setFromMat4(t){const i=t.toArray();if(16!==i.length)throw new Error("Matrix must contain 16 elements");const[s,r,e,,a,h,n,,x,o,y]=i;for(let t=0;t<this.length;t++)this._matrix[0]=s,this._matrix[1]=r,this._matrix[2]=e,this._matrix[3]=a,this._matrix[4]=h,this._matrix[5]=n,this._matrix[6]=x,this._matrix[7]=o,this._matrix[8]=y;return this}multiply(t){const[i,s,r,e,a,h,n,x,o]=this._matrix,[y,_,u,l,c,z,m,w,d]=t._matrix;return this._matrix[0]=i*y+s*l+r*m,this._matrix[1]=i*_+s*c+r*w,this._matrix[2]=i*u+s*z+r*d,this._matrix[3]=e*y+a*l+h*m,this._matrix[4]=e*_+a*c+h*w,this._matrix[5]=e*u+a*z+h*d,this._matrix[6]=n*y+x*l+o*m,this._matrix[7]=n*_+x*c+o*w,this._matrix[8]=n*u+x*z+o*d,this}multiplyScalar(t){for(let i=0;i<this.length;i++)this._matrix[i]*=t;return this}transpose(){const t=(new a).setFromMat3(this);return this.set(t.x_x,t.y_x,t.z_x,t.x_y,t.y_y,t.z_y,t.x_z,t.y_z,t.z_z),this}invert(){const t=new a;t.set(this.y_y*this.z_z-this.z_y*this.y_z,this.y_x*this.z_z-this.z_x*this.y_z,this.y_x*this.z_y-this.z_x*this.y_y,this.x_y*this.z_z-this.z_y*this.x_z,this.x_x*this.z_z-this.z_x*this.x_z,this.x_x*this.z_y-this.z_x*this.x_y,this.x_y*this.y_z-this.y_y*this.x_z,this.x_x*this.y_z-this.y_x*this.x_z,this.x_x*this.y_y-this.y_x*this.x_y),t.set(t.x_x,-t.x_y,t.x_z,-t.y_x,t.y_y,-t.y_z,t.z_x,-t.z_y,t.z_z);const i=this.x_x*t.x_x+this.x_y*t.x_y+this.x_z*t.x_z;if(i){const s=1/i;this.set(s*t.x_x,s*t.y_x,s*t.z_x,s*t.x_y,s*t.y_y,s*t.z_y,s*t.x_z,s*t.y_z,s*t.z_z)}else this.set(0,0,0,0,0,0,0,0,0);return this}getDeterminant(){const[t,i,s,r,e,a,h,n,x]=this._matrix;return t*e*x-t*a*n+i*a*h-i*r*x+s*r*n-s*e*h}getTRS(){const t=new e(this.z_x,this.z_y),i=Math.sqrt(this.x_x*this.x_x+this.x_y*this.x_y),s=Math.sqrt(this.y_x*this.y_x+this.y_y*this.y_y),r=new e(i,s),a=Math.atan(-this.x_y/this.x_x),h=Math.acos(this.x_x/i);let n;return n=h>Math.PI/2&&a>0||h<Math.PI/2&&a<0?2*Math.PI-h:h,{t:t,r:n,s:r}}equals(t,i=6){for(let s=0;s<this.length;s++)if(+this._matrix[s].toFixed(i)!=+t._matrix[s].toFixed(i))return!1;return!0}applyScaling(t,i){const s=a.buildScale(t,i);return this.multiply(s)}applyTranslation(t,i){const s=a.buildTranslate(t,i);return this.multiply(s)}applyRotation(t){const i=a.buildRotation(t);return this.multiply(i)}toArray(){return this._matrix.slice()}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){for(let t=0;t<9;t++)yield this._matrix[t]}}class h{constructor(t=0,i=0,s=0,r=1){this.x=t,this.y=i,this.z=s,this.w=r}static fromRotationMatrix(t){return(new h).setFromRotationMatrix(t)}static fromEuler(t){return(new h).setFromEuler(t)}static fromVec3Angle(t,i){return(new h).setFromVec3Angle(t,i)}static fromVec3s(t,i){return(new h).setFromVec3s(t,i)}static normalize(t){return t.clone().normalize()}static invert(t){return t.clone().normalize().invert()}static dotProduct(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w}static getAngle(t,i){return t.getAngle(i)}static multiply(t,i){return t.clone().multiply(i)}static slerp(t,i,s){return t.clone().slerp(i,s)}static equals(t,i,s=6){return t.equals(i,s)}clone(){return new h(this.x,this.y,this.z,this.w)}set(t,i,s,r){return this.x=t,this.y=i,this.z=s,this.w=r,this}setFromVec3s(t,i){t=t.clone().normalize(),i=i.clone().normalize();let s=t.dotProduct(i)+1;if(s<1e-6)s=0,Math.abs(t.x)>Math.abs(t.z)?(this.x=-t.y,this.y=t.x,this.z=0):(this.x=0,this.y=-t.z,this.z=t.y);else{const{x:s,y:r,z:e}=t.crossProduct(i);this.x=s,this.y=r,this.z=e}return this.w=s,this.normalize()}setFromQ(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}setFromRotationMatrix(t){if(16!==t.length)throw new Error("Matrix must contain 16 elements");const[i,s,r,e,a,h,n,x,o,y,_,u,l,c,z,m]=t,w=i+h+_;if(w>0){const t=.5/Math.sqrt(1+w);this.set((n-y)*t,(o-r)*t,(s-a)*t,.25/t)}else if(i>h&&i>_){const t=2*Math.sqrt(1+i-h-_);this.set(.25*t,(a+s)/t,(o+r)/t,(n-y)/t)}else if(h>_){const t=2*Math.sqrt(1+h-i-_);this.set((a+s)/t,.25*t,(y+n)/t,(o-r)/t)}else{const t=2*Math.sqrt(1+_-i-h);this.set((o+r)/t,(y+n)/t,.25*t,(s-a)/t)}return this}setFromEuler(t){const i=Math.cos(t.x/2),s=Math.cos(t.y/2),r=Math.cos(t.z/2),e=Math.sin(t.x/2),a=Math.sin(t.y/2),h=Math.sin(t.z/2);switch(t.order){case"XYZ":this.x=e*s*r+i*a*h,this.y=i*a*r-e*s*h,this.z=i*s*h+e*a*r,this.w=i*s*r-e*a*h;break;case"XZY":this.x=e*s*r-i*a*h,this.y=i*a*r-e*s*h,this.z=i*s*h+e*a*r,this.w=i*s*r+e*a*h;break;case"YXZ":this.x=e*s*r+i*a*h,this.y=i*a*r-e*s*h,this.z=i*s*h-e*a*r,this.w=i*s*r+e*a*h;break;case"YZX":this.x=e*s*r+i*a*h,this.y=i*a*r+e*s*h,this.z=i*s*h-e*a*r,this.w=i*s*r-e*a*h;break;case"ZXY":this.x=e*s*r-i*a*h,this.y=i*a*r+e*s*h,this.z=i*s*h+e*a*r,this.w=i*s*r-e*a*h;break;case"ZYX":this.x=e*s*r-i*a*h,this.y=i*a*r+e*s*h,this.z=i*s*h-e*a*r,this.w=i*s*r+e*a*h}return this}setFromVec3Angle(t,i){const s=t.clone().normalize(),r=i/2,e=Math.sin(r);return this.x=s.x*e,this.y=s.y*e,this.z=s.z*e,this.w=Math.cos(r),this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}invert(){return this.normalize(),this.x*=-1,this.y*=-1,this.z*=-1,this}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}getAngle(t){return 2*Math.acos(Math.abs(s(this.dotProduct(t),-1,1)))}multiply(t){const{x:i,y:s,z:r,w:e}=this,{x:a,y:h,z:n,w:x}=t;return this.x=i*x+e*a+s*n-r*h,this.y=s*x+e*h+r*a-i*n,this.z=r*x+e*n+i*h-s*a,this.w=e*x-i*a-s*h-r*n,this}slerp(t,i){if(!(i=s(i,0,1)))return this;if(1===i)return this.setFromQ(t);const{x:r,y:e,z:a,w:h}=this,{x:n,y:x,z:o,w:y}=t,_=r*n+e*x+a*o+h*y;if(Math.abs(_)>=1)return this;const u=Math.acos(_),l=Math.sin(u);if(Math.abs(l)<1e-6)return this.x=.5*(r+n),this.y=.5*(e+x),this.z=.5*(a+o),this.w=.5*(h+y),this;const c=Math.sin((1-i)*u)/l,z=Math.sin(i*u)/l;return this.x=c*r+z*n,this.y=c*e+z*x,this.z=c*a+z*o,this.w=c*h+z*y,this}equals(t,i=6){return+this.x.toFixed(i)==+t.x.toFixed(i)&&+this.y.toFixed(i)==+t.y.toFixed(i)&&+this.z.toFixed(i)==+t.z.toFixed(i)&&+this.w.toFixed(i)==+t.w.toFixed(i)}}class n{constructor(t=0,i=0,s=0){this.length=3,this.x=t,this.y=i,this.z=s}static multiplyByScalar(t,i){return new n(t.x*i,t.y*i,t.z*i)}static addScalar(t,i){return new n(t.x+i,t.y+i,t.z+i)}static normalize(t){return(new n).setFromVec3(t).normalize()}static add(t,i){return new n(t.x+i.x,t.y+i.y,t.z+i.z)}static substract(t,i){return new n(t.x-i.x,t.y-i.y,t.z-i.z)}static dotProduct(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}static crossProduct(t,i){return new n(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)}static onVector(t,i){return t.clone().onVector(i)}static onPlane(t,i){return t.clone().onPlane(i)}static applyMat3(t,i){return t.clone().applyMat3(i)}static applyMat4(t,i){return t.clone().applyMat4(i)}static lerp(t,i,s){return t.clone().lerp(i,s)}static equals(t,i,s=6){return!!t&&t.equals(i,s)}static getDistance(t,i){const s=i.x-t.x,r=i.y-t.y,e=i.z-t.z;return Math.sqrt(s*s+r*r+e*e)}static getAngle(t,i){return t.getAngle(i)}clone(){return new n(this.x,this.y,this.z)}set(t,i,s){return this.x=t,this.y=i,this.z=s,this}setFromVec3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getAngle(t){const i=this.getMagnitude()*t.getMagnitude();if(!i)return Math.PI/2;const r=this.dotProduct(t)/i;return Math.acos(s(r,-1,1))}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}substract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}dotProduct(t){return n.dotProduct(this,t)}crossProduct(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x,this}onVector(t){const i=this.getMagnitude();return i?t.clone().multiplyByScalar(t.clone().dotProduct(this)/(i*i)):this.set(0,0,0)}onPlane(t){return this.substract(this.clone().onVector(t))}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:i,y:s,z:r}=this,[e,a,h,n,x,o,y,_,u]=t;return this.x=i*e+s*n+r*y,this.y=i*a+s*x+r*_,this.z=i*h+s*o+r*u,this}applyMat4(t){if(16!==t.length)throw new Error("Matrix must contain 16 elements");const{x:i,y:s,z:r}=this,[e,a,h,n,x,o,y,_,u,l,c,z,m,w,d,M]=t,g=1/(i*n+s*_+r*z+M);return this.x=(i*e+s*x+r*u+m)*g,this.y=(i*a+s*o+r*l+w)*g,this.z=(i*h+s*y+r*c+d)*g,this}lerp(t,i){return this.x+=i*(t.x-this.x),this.y+=i*(t.y-this.y),this.z+=i*(t.z-this.z),this}equals(t,i=6){return!!t&&(+this.x.toFixed(i)==+t.x.toFixed(i)&&+this.y.toFixed(i)==+t.y.toFixed(i)&&+this.z.toFixed(i)==+t.z.toFixed(i))}toArray(){return[this.x,this.y,this.z]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class x{constructor(){this.length=16,this._matrix=new Array(this.length),this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=0,this._matrix[5]=1,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=0,this._matrix[9]=0,this._matrix[10]=1,this._matrix[11]=0,this._matrix[12]=0,this._matrix[13]=0,this._matrix[14]=0,this._matrix[15]=1}get x_x(){return this._matrix[0]}get x_y(){return this._matrix[1]}get x_z(){return this._matrix[2]}get x_w(){return this._matrix[3]}get y_x(){return this._matrix[4]}get y_y(){return this._matrix[5]}get y_z(){return this._matrix[6]}get y_w(){return this._matrix[7]}get z_x(){return this._matrix[8]}get z_y(){return this._matrix[9]}get z_z(){return this._matrix[10]}get z_w(){return this._matrix[11]}get w_x(){return this._matrix[12]}get w_y(){return this._matrix[13]}get w_z(){return this._matrix[14]}get w_w(){return this._matrix[15]}static fromMat4(t){return(new x).setFromMat4(t)}static fromTRS(t,i,s){return(new x).setFromTRS(t,i,s)}static fromQuaternion(t){return(new x).setFromQuaternion(t)}static multiply(t,i){const s=new x;return s.set(t.x_x*i.x_x+t.x_y*i.y_x+t.x_z*i.z_x+t.x_w*i.w_x,t.x_x*i.x_y+t.x_y*i.y_y+t.x_z*i.z_y+t.x_w*i.w_y,t.x_x*i.x_z+t.x_y*i.y_z+t.x_z*i.z_z+t.x_w*i.w_z,t.x_x*i.x_w+t.x_y*i.y_w+t.x_z*i.z_w+t.x_w*i.w_w,t.y_x*i.x_x+t.y_y*i.y_x+t.y_z*i.z_x+t.y_w*i.w_x,t.y_x*i.x_y+t.y_y*i.y_y+t.y_z*i.z_y+t.y_w*i.w_y,t.y_x*i.x_z+t.y_y*i.y_z+t.y_z*i.z_z+t.y_w*i.w_z,t.y_x*i.x_w+t.y_y*i.y_w+t.y_z*i.z_w+t.y_w*i.w_w,t.z_x*i.x_x+t.z_y*i.y_x+t.z_z*i.z_x+t.z_w*i.w_x,t.z_x*i.x_y+t.z_y*i.y_y+t.z_z*i.z_y+t.z_w*i.w_y,t.z_x*i.x_z+t.z_y*i.y_z+t.z_z*i.z_z+t.z_w*i.w_z,t.z_x*i.x_w+t.z_y*i.y_w+t.z_z*i.z_w+t.z_w*i.w_w,t.w_x*i.x_x+t.w_y*i.y_x+t.w_z*i.z_x+t.w_w*i.w_x,t.w_x*i.x_y+t.w_y*i.y_y+t.w_z*i.z_y+t.w_w*i.w_y,t.w_x*i.x_z+t.w_y*i.y_z+t.w_z*i.z_z+t.w_w*i.w_z,t.w_x*i.x_w+t.w_y*i.y_w+t.w_z*i.z_w+t.w_w*i.w_w),s}static multiplyScalar(t,i){const s=new x;for(let r=0;r<this.length;r++)s._matrix[r]=t._matrix[r]*i;return s}static transpose(t){const i=new x;return i.set(t.x_x,t.y_x,t.z_x,t.w_x,t.x_y,t.y_y,t.z_y,t.w_y,t.x_z,t.y_z,t.z_z,t.w_z,t.x_w,t.y_w,t.z_w,t.w_w),i}static invert(t){const i=1/t.getDeterminant(),[s,r,e,a,h,n,o,y,_,u,l,c,z,m,w,d]=t._matrix;return(new x).set((o*c*m-y*l*m+y*u*w-n*c*w-o*u*d+n*l*d)*i,(a*l*m-e*c*m-a*u*w+r*c*w+e*u*d-r*l*d)*i,(e*y*m-a*o*m+a*n*w-r*y*w-e*n*d+r*o*d)*i,(a*o*u-e*y*u-a*n*l+r*y*l+e*n*c-r*o*c)*i,(y*l*z-o*c*z-y*_*w+h*c*w+o*_*d-h*l*d)*i,(e*c*z-a*l*z+a*_*w-s*c*w-e*_*d+s*l*d)*i,(a*o*z-e*y*z-a*h*w+s*y*w+e*h*d-s*o*d)*i,(e*y*_-a*o*_+a*h*l-s*y*l-e*h*c+s*o*c)*i,(n*c*z-y*u*z+y*_*m-h*c*m-n*_*d+h*u*d)*i,(a*u*z-r*c*z-a*_*m+s*c*m+r*_*d-s*u*d)*i,(r*y*z-a*n*z+a*h*m-s*y*m-r*h*d+s*n*d)*i,(a*n*_-r*y*_-a*h*u+s*y*u+r*h*c-s*n*c)*i,(o*u*z-n*l*z-o*_*m+h*l*m+n*_*w-h*u*w)*i,(r*l*z-e*u*z+e*_*m-s*l*m-r*_*w+s*u*w)*i,(e*n*z-r*o*z-e*h*m+s*o*m+r*h*w-s*n*w)*i,(r*o*_-e*n*_+e*h*u-s*o*u-r*h*l+s*n*l)*i)}static lookAt(t,i,s){const r=n.equals(t,i)?new n(0,0,1):n.substract(t,i).normalize();let e=n.crossProduct(s,r).normalize();e.getMagnitude()||(1===Math.abs(s.z)?r.x+=1e-5:r.z+=1e-5,r.normalize(),e=n.crossProduct(s,r).normalize());const a=n.crossProduct(r,e).normalize();return(new x).set(e.x,e.y,e.z,0,a.x,a.y,a.z,0,r.x,r.y,r.z,0,t.x,t.y,t.z,1)}static buildScale(t,i,s){return null!=i||(i=t),null!=s||(s=t),(new x).set(t,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1)}static buildRotationX(t){const i=Math.cos(t),s=Math.sin(t);return(new x).set(1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1)}static buildRotationY(t){const i=Math.cos(t),s=Math.sin(t);return(new x).set(i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1)}static buildRotationZ(t){const i=Math.cos(t),s=Math.sin(t);return(new x).set(i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1)}static buildTranslate(t,i,s){return(new x).set(1,0,0,0,0,1,0,0,0,0,1,0,t,i,s,1)}static buildOrthographic(t,i,s,r,e,a){return(new x).set(2/(r-s),0,0,0,0,2/(a-e),0,0,0,0,2/(t-i),0,(s+r)/(s-r),(e+a)/(e-a),(t+i)/(t-i),1)}static buildPerspective(t,i,...s){if(4===s.length){const[r,e,a,h]=s;return(new x).set(2*t/(e-r),0,0,0,0,2*t/(h-a),0,0,(e+r)/(e-r),(h+a)/(h-a),(t+i)/(t-i),-1,0,0,2*t*i/(t-i),0)}if(2===s.length){const[r,e]=s,a=Math.tan(.5*Math.PI-.5*r);return(new x).set(a/e,0,0,0,0,a,0,0,0,0,(t+i)/(t-i),-1,0,0,2*t*i/(t-i),0)}throw new Error("Incorrect args quantity")}static equals(t,i,s=6){return t.equals(i,s)}clone(){return(new x).set(this.x_x,this.x_y,this.x_z,this.x_w,this.y_x,this.y_y,this.y_z,this.y_w,this.z_x,this.z_y,this.z_z,this.z_w,this.w_x,this.w_y,this.w_z,this.w_w)}set(t,i,s,r,e,a,h,n,x,o,y,_,u,l,c,z){return this._matrix[0]=t,this._matrix[1]=i,this._matrix[2]=s,this._matrix[3]=r,this._matrix[4]=e,this._matrix[5]=a,this._matrix[6]=h,this._matrix[7]=n,this._matrix[8]=x,this._matrix[9]=o,this._matrix[10]=y,this._matrix[11]=_,this._matrix[12]=u,this._matrix[13]=l,this._matrix[14]=c,this._matrix[15]=z,this}reset(){return this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=0,this._matrix[5]=1,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=0,this._matrix[9]=0,this._matrix[10]=1,this._matrix[11]=0,this._matrix[12]=0,this._matrix[13]=0,this._matrix[14]=0,this._matrix[15]=1,this}setFromMat4(t){for(let i=0;i<this.length;i++)this._matrix[i]=t._matrix[i];return this}setFromTRS(t,i,s){const r=2*i.x*i.x,e=2*i.y*i.x,a=2*i.z*i.x,h=2*i.y*i.y,n=2*i.z*i.y,x=2*i.z*i.z,o=2*i.x*i.w,y=2*i.y*i.w,_=2*i.z*i.w;return this.set((1-h-x)*s.x,(e+_)*s.x,(a-y)*s.x,0,(e-_)*s.y,(1-r-x)*s.y,(n+o)*s.y,0,(a+y)*s.z,(n-o)*s.z,(1-r-h)*s.z,0,t.x,t.y,t.z,1),this}setFromQuaternion(t){return this.setFromTRS(new n(0,0,0),t,new n(1,1,1))}multiply(t){const[i,s,r,e,a,h,n,x,o,y,_,u,l,c,z,m]=this._matrix,[w,d,M,g,p,b,f,F,P,q,S,A,R,V,B,T]=t._matrix;return this._matrix[0]=i*w+s*p+r*P+e*R,this._matrix[1]=i*d+s*b+r*q+e*V,this._matrix[2]=i*M+s*f+r*S+e*B,this._matrix[3]=i*g+s*F+r*A+e*T,this._matrix[4]=a*w+h*p+n*P+x*R,this._matrix[5]=a*d+h*b+n*q+x*V,this._matrix[6]=a*M+h*f+n*S+x*B,this._matrix[7]=a*g+h*F+n*A+x*T,this._matrix[8]=o*w+y*p+_*P+u*R,this._matrix[9]=o*d+y*b+_*q+u*V,this._matrix[10]=o*M+y*f+_*S+u*B,this._matrix[11]=o*g+y*F+_*A+u*T,this._matrix[12]=l*w+c*p+z*P+m*R,this._matrix[13]=l*d+c*b+z*q+m*V,this._matrix[14]=l*M+c*f+z*S+m*B,this._matrix[15]=l*g+c*F+z*A+m*T,this}multiplyScalar(t){for(let i=0;i<this.length;i++)this._matrix[i]*=t;return this}transpose(){const t=(new x).setFromMat4(this);return this.set(t.x_x,t.y_x,t.z_x,t.w_x,t.x_y,t.y_y,t.z_y,t.w_y,t.x_z,t.y_z,t.z_z,t.w_z,t.x_w,t.y_w,t.z_w,t.w_w),this}invert(){const t=1/this.getDeterminant(),[i,s,r,e,a,h,n,x,o,y,_,u,l,c,z,m]=this._matrix;return this.set((n*u*c-x*_*c+x*y*z-h*u*z-n*y*m+h*_*m)*t,(e*_*c-r*u*c-e*y*z+s*u*z+r*y*m-s*_*m)*t,(r*x*c-e*n*c+e*h*z-s*x*z-r*h*m+s*n*m)*t,(e*n*y-r*x*y-e*h*_+s*x*_+r*h*u-s*n*u)*t,(x*_*l-n*u*l-x*o*z+a*u*z+n*o*m-a*_*m)*t,(r*u*l-e*_*l+e*o*z-i*u*z-r*o*m+i*_*m)*t,(e*n*l-r*x*l-e*a*z+i*x*z+r*a*m-i*n*m)*t,(r*x*o-e*n*o+e*a*_-i*x*_-r*a*u+i*n*u)*t,(h*u*l-x*y*l+x*o*c-a*u*c-h*o*m+a*y*m)*t,(e*y*l-s*u*l-e*o*c+i*u*c+s*o*m-i*y*m)*t,(s*x*l-e*h*l+e*a*c-i*x*c-s*a*m+i*h*m)*t,(e*h*o-s*x*o-e*a*y+i*x*y+s*a*u-i*h*u)*t,(n*y*l-h*_*l-n*o*c+a*_*c+h*o*z-a*y*z)*t,(s*_*l-r*y*l+r*o*c-i*_*c-s*o*z+i*y*z)*t,(r*h*l-s*n*l-r*a*c+i*n*c+s*a*z-i*h*z)*t,(s*n*o-r*h*o+r*a*y-i*n*y-s*a*_+i*h*_)*t),this}getDeterminant(){const[t,i,s,r,e,a,h,n,x,o,y,_,u,l,c,z]=this._matrix;return r*h*o*u-s*n*o*u-r*a*y*u+i*n*y*u+s*a*_*u-i*h*_*u-r*h*x*l+s*n*x*l+r*e*y*l-t*n*y*l-s*e*_*l+t*h*_*l+r*a*x*c-i*n*x*c-r*e*o*c+t*n*o*c+i*e*_*c-t*a*_*c-s*a*x*z+i*h*x*z+s*e*o*z-t*h*o*z-i*e*y*z+t*a*y*z}getTRS(){const t=new n(this.w_x,this.w_y,this.w_z),i=this.getDeterminant(),s=new n(this.x_x,this.x_y,this.x_z).getMagnitude()*(i<0?-1:1),r=new n(this.y_x,this.y_y,this.y_z).getMagnitude(),e=new n(this.z_x,this.z_y,this.z_z).getMagnitude(),a=new n(s,r,e),o=(new x).set(this.x_x/s,this.x_y/s,this.x_z/s,0,this.y_x/r,this.y_y/r,this.y_z/r,0,this.z_x/e,this.z_y/e,this.z_z/e,0,0,0,0,1);return{t:t,r:h.fromRotationMatrix(o),s:a}}equals(t,i=6){for(let s=0;s<this.length;s++)if(+this._matrix[s].toFixed(i)!=+t._matrix[s].toFixed(i))return!1;return!0}applyScaling(t,i,s){const r=x.buildScale(t,i,s);return this.multiply(r)}applyTranslation(t,i,s){const r=x.buildTranslate(t,i,s);return this.multiply(r)}applyRotation(t,i){let s;switch(t){case"x":default:s=x.buildRotationX(i);break;case"y":s=x.buildRotationY(i);break;case"z":s=x.buildRotationZ(i)}return this.multiply(s)}toArray(){return this._matrix.slice()}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this._matrix[t]}}class o{constructor(t=new n(0,0,1),i=0){if(!t.getMagnitude())throw new Error("Normal length is zero. Cannot define direction");this.normal=t.clone().normalize(),this.d=i}get point(){return this.normal.clone().multiplyByScalar(-this.d)}static equals(t,i,s=6){return t.equals(i,s)}static fromNormalAndPoint(t,i){return(new o).setFromNormalAndPoint(t,i)}static fromVec3s(t,i,s){return(new o).setFromPoints(t,i,s)}static applyMat4(t,i){return t.clone().applyMat4(i)}static multiplyByScalar(t,i){return t.clone().multiplyByScalar(i)}static translate(t,i){return t.clone().translate(i)}static projectPoint(t,i){return t.projectPoint(i)}clone(){return new o(this.normal,this.d)}set(t,i){if(!t.getMagnitude())throw new Error("Normal length is zero. Cannot define direction");return this.normal=t.clone().normalize(),this.d=i,this}setFromNormalAndPoint(t,i){if(!t.getMagnitude())throw new Error("Normal length is zero. Cannot define direction");return this.normal.setFromVec3(t).normalize(),this.d=-i.dotProduct(t),this}setFromPoints(t,i,s){const r=n.substract(i,t).crossProduct(n.substract(s,t));if(!r.getMagnitude())throw new Error("Normal length is zero. Points are equal or collinear");return this.setFromNormalAndPoint(r,t),this}applyMat4(t){const i=t.clone().invert().transpose(),s=this.point.applyMat4(t);return this.normal.applyMat4(i).normalize(),this.d=-s.dotProduct(this.normal),this}normalize(){const t=1/this.normal.getMagnitude();return this.multiplyByScalar(t)}multiplyByScalar(t){return this.normal.multiplyByScalar(t),this.d*=t,this}translate(t){return this.d-=t.dotProduct(this.normal),this}equals(t,i=6){return this.normal.equals(t.normal,i)&&+this.d.toFixed(i)==+t.d.toFixed(i)}getDistanceToPoint(t){return this.normal.dotProduct(t)+this.d}projectPoint(t){return n.multiplyByScalar(this.normal,-this.getDistanceToPoint(t)).add(t)}}class y{constructor(t,i){this.a=t.clone(),this.b=i.clone()}static fromLine(t){return new y(t.a,t.b)}static applyMat4(t,i){return new y(n.applyMat4(t.a,i),n.applyMat4(t.b,i))}static equals(t,i){return t.equals(i)}clone(){return new y(this.a,this.b)}set(t,i){return this.a=t.clone(),this.b=i.clone(),this}setFromLine(t){return this.a=t.a.clone(),this.b=t.b.clone(),this}getCenter(){return n.add(this.a,this.b).multiplyByScalar(.5)}getDelta(){return n.substract(this.b,this.a)}getLength(){return i(this.a.x,this.a.y,this.a.z,this.b.x,this.b.y,this.b.z)}applyMat4(t){return this.a.applyMat4(t),this.b.applyMat4(t),this}equals(t,i=6){return!(!this.a.equals(t.a,i)||!this.b.equals(t.b,i))}}class _{constructor(t,i,s){this.a=t,this.b=i,this.c=s}static fromTriangle(t){return new _(t.a,t.b,t.c)}static equals(t,i,s=6){return t.equals(i,s)}clone(){return new _(this.a,this.b,this.c)}set(t,i,s){this.a=t,this.b=i,this.c=s}setFromTriangle(t){return this.a=t.a.clone(),this.b=t.b.clone(),this.c=t.c.clone(),this}getArea(){const t=this.b.clone().substract(this.a),i=this.c.clone().substract(this.a);return t.crossProduct(i).getMagnitude()/2}getCenter(){return this.a.clone().add(this.b).add(this.c).multiplyByScalar(1/3)}getNormal(){const t=this.b.clone().substract(this.a),i=this.c.clone().substract(this.a);return t.crossProduct(i).normalize()}getBary(t){const i=this.c.clone().substract(this.a),s=this.b.clone().substract(this.a),r=t.clone().substract(this.a),e=i.dotProduct(i),a=i.dotProduct(s),h=i.dotProduct(r),x=s.dotProduct(s),o=s.dotProduct(r),y=e*x-a*a;if(!y)return null;const _=(e*o-a*h)/y,u=(x*h-a*o)/y;return new n(1-_-u,_,u)}getUV(t,i,s,r){const a=this.getBary(t);return(new e).add(i.clone().multiplyByScalar(a.x)).add(s.clone().multiplyByScalar(a.y)).add(r.clone().multiplyByScalar(a.z))}valid(t){return!!this.getBary(t)}contains(t){const i=this.getBary(t);return i.x>=0&&i.y>=0&&i.x+i.y<=1}equals(t,i=6){return!!(this.a.equals(t.a,i)&&this.b.equals(t.b,i)&&this.c.equals(t.c,i))}}class u{constructor(t=0,i=0,s=0,r=1){this.length=4,this.x=t,this.y=i,this.z=s,this.w=r}static fromVec3(t){return new u(t.x,t.y,t.z)}static multiplyByScalar(t,i){return new u(t.x*i,t.y*i,t.z*i,t.w*i)}static addScalar(t,i){return new u(t.x+i,t.y+i,t.z+i,t.w+i)}static normalize(t){return(new u).setFromVec4(t).normalize()}static add(t,i){return new u(t.x+i.x,t.y+i.y,t.z+i.z,t.w+i.w)}static substract(t,i){return new u(t.x-i.x,t.y-i.y,t.z-i.z,t.w-i.w)}static dotProduct(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w}static applyMat4(t,i){return t.clone().applyMat4(i)}static lerp(t,i,s){return t.clone().lerp(i,s)}static equals(t,i,s=6){return!!t&&t.equals(i,s)}clone(){return new u(this.x,this.y,this.z,this.w)}set(t,i,s,r){return this.x=t,this.y=i,this.z=s,this.w=r,this}setFromVec3(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=1}setFromVec4(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}substract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}applyMat4(t){if(16!==t.length)throw new Error("Matrix must contain 16 elements");const{x:i,y:s,z:r,w:e}=this,[a,h,n,x,o,y,_,u,l,c,z,m,w,d,M,g]=t;return this.x=i*a+s*o+r*l+e*w,this.y=i*h+s*y+r*c+e*d,this.z=i*n+s*_+r*z+e*M,this.w=i*x+s*u+r*m+e*g,this}lerp(t,i){return this.x+=i*(t.x-this.x),this.y+=i*(t.y-this.y),this.z+=i*(t.z-this.z),this.w+=i*(t.w-this.w),this}equals(t,i=6){return!!t&&(+this.x.toFixed(i)==+t.x.toFixed(i)&&+this.y.toFixed(i)==+t.y.toFixed(i)&&+this.z.toFixed(i)==+t.z.toFixed(i)&&+this.w.toFixed(i)==+t.w.toFixed(i))}toArray(){return[this.x,this.y,this.z,this.w]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}t.EulerAngles=r,t.Mat3=a,t.Mat4=x,t.Plane=o,t.Quaternion=h,t.Segment=y,t.Triangle=_,t.Vec2=e,t.Vec3=n,t.Vec4=u,t.clamp=s,t.degToRad=function(t){return t*Math.PI/180},t.getDistance2D=function(t,i,s,r){const e=s-t,a=r-i;return Math.sqrt(e*e+a*a)},t.getDistance3D=i,t.getRandomArrayElement=function(t){return t[Math.floor(Math.random()*t.length)]},t.getRandomFloat=function(t,i){return Math.random()*(i-t)+t},t.getRandomInt=function(t,i){return Math.round(Math.random()*(i-t))+t},t.isPowerOf2=function(t){return 0==(t&t-1)},t.lerp=function(t,i,s){return t*(1-s)+i*s},t.radToDeg=function(t){return 180*t/Math.PI},t.smoothstep=function(t,i,r,e){return t=s((t-i)/(r-i),0,1),e?t*t*t*(t*(6*t-15)+10):t*t*(3-2*t)},Object.defineProperty(t,"__esModule",{value:!0})}));
